<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>M3U8 Video Player</title>
<script src="https://cdn.staticfile.org/jquery/1.10.2/jquery.min.js"></script>
</head>
<body>

<script src="https://cdn.jsdelivr.net/npm/hls.js@1"></script>
<input type="text" id="textInput" placeholder="">
<button onclick="readInput()">读取输入框内容</button>
<video controls style="width: 100%; height:auto" id="video" autoplay></video>
 <script>
    var urlParams = new URLSearchParams(window.location.search);

    // 使用 get() 方法获取指定参数的值
    let roomId = urlParams.get('roomid');
    console.log(roomId)
    if(roomId){
        refresh(roomId)
    }
    function readInput() {
    // 获取输入框的值
        var roomId = document.getElementById('textInput').value;
        refresh(roomId)
    }
    function refresh(roomId){
        console.log(roomId)
        $.ajax({
            url: "https://junlong.plus/ztool/live/bilibili/" + roomId,
            type: "get",
            dataType: "html",
            success: function(data){
                showData(data);
            },
            error: function(msg){
                alert("ajax连接异常："+msg);
            }
        });
    };

    function showData(data) {
        var str = "";//定义用于拼接的字符串
        console.log(data)
        let k = /url: '(.*?)'/
        let matches = data.match(k)
        liveLink =  matches[1]
        playhls(liveLink)
    }
    function playhls(url){
        var video = document.getElementById('video');
        var videoSrc = url;
        //
        // First check for native browser HLS support
        //
        if (video.canPlayType('application/vnd.apple.mpegurl')) {
            video.src = videoSrc;
            //
            // If no native HLS support, check if HLS.js is supported
            //
        } else if (Hls.isSupported()) {
            var hls = new Hls();
            hls.loadSource(videoSrc);
            hls.attachMedia(video);
        }
  }
</script>

<script>

</script>

</body>
</html>
